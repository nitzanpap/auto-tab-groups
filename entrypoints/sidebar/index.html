<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Tab Groups</title>
    <meta name="manifest.type" content="side_panel" />
    <link rel="stylesheet" href="/fonts/inter.css" />
  </head>
  <body class="sidebar-container">
    <div class="popup-container">
      <h1>Auto Tab Groups</h1>
      <main>
        <div class="button-group-row">
          <button id="group" class="button primaryButton">Group Tabs</button>
          <button id="ungroup" class="button primaryButton">Ungroup All</button>
        </div>
        <button
          id="generateNewColors"
          class="button gradientButton"
          title="Randomize group colors. Colors are saved and restored automatically for each domain/rule."
        >
          Generate New Colors
        </button>
        <div class="button-group-row">
          <button id="collapseAllButton" class="button secondaryButton collapse-all-button">
            Collapse All
          </button>
          <button id="expandAllButton" class="button secondaryButton expand-all-button">
            Expand All
          </button>
        </div>
        <div class="separator"></div>
        <div class="settings-container">
          <h2>Settings</h2>
          <div class="toggle-container">
            <span>Auto-Group Mode</span>
            <label class="switch">
              <input type="checkbox" id="autoGroupToggle" />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="toggle-container">
            <span>Group by</span>
            <div class="group-by-toggle-bar">
              <button class="toggle-option" data-value="rules-only">Rules only</button>
              <button class="toggle-option active" data-value="domain">Domain</button>
              <button class="toggle-option" data-value="subdomain">Sub-domain</button>
            </div>
          </div>
          <div class="toggle-container">
            <span>Group new empty tabs under "System"</span>
            <label class="switch">
              <input type="checkbox" id="groupNewTabsToggle" />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="toggle-container">
            <span>Minimum tabs to form a group</span>
            <div class="number-input-container">
              <input
                type="number"
                id="minimumTabsInput"
                min="1"
                max="10"
                value="1"
                class="number-input"
              />
            </div>
          </div>
          <div class="toggle-container">
            <span>Auto-collapse inactive groups</span>
            <label class="switch">
              <input type="checkbox" id="autoCollapseToggle" />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="toggle-container collapse-delay-container" id="collapseDelayContainer">
            <span>Collapse delay</span>
            <div class="delay-input-group">
              <input
                type="number"
                id="collapseDelayInput"
                min="0"
                max="5000"
                step="100"
                value="0"
                class="number-input delay-input"
              />
              <span class="delay-unit">ms</span>
            </div>
          </div>
          <div class="help-text collapse-help" id="collapseHelp">
            0 = immediate, or set delay (100-5000ms) before collapsing
          </div>
          <div class="settings-info">
            <span class="info-icon">&#128204;</span>
            <span>Pinned tabs are never grouped automatically</span>
          </div>
        </div>

        <!-- AI Features Section -->
        <div class="ai-section">
          <button class="ai-toggle">
            <span class="noselect">AI Features</span>
            <span class="ai-badge" id="aiBadge">Off</span>
            <span class="up-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path
                  d="m16.707 13.293-4-4a1 1 0 0 0-1.414 0l-4 4A1 1 0 0 0 8 15h8a1 1 0 0 0 .707-1.707z"
                  style="fill: #7c3aed"
                  data-name="Up"
                />
              </svg>
            </span>
          </button>
          <div class="ai-content">
            <div class="toggle-container">
              <span>Enable AI</span>
              <label class="switch">
                <input type="checkbox" id="aiEnabledToggle" />
                <span class="slider round"></span>
              </label>
            </div>
            <div class="ai-settings" id="aiSettings">
              <div class="toggle-container">
                <span>Model</span>
                <select id="aiModelSelect" class="ai-select">
                  <option value="Qwen2.5-0.5B-Instruct-q4f16_1-MLC">Qwen2.5 0.5B (Recommended)</option>
                  <option value="SmolLM2-360M-Instruct-q4f16_1-MLC">SmolLM2 360M</option>
                  <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B</option>
                </select>
              </div>
              <div class="ai-status-row">
                <span class="ai-status-label">Status:</span>
                <span class="ai-status-badge" id="aiStatusBadge">Idle</span>
              </div>
              <div class="ai-progress-bar" id="aiProgressBar">
                <div class="ai-progress-fill" id="aiProgressFill"></div>
              </div>
              <button id="aiLoadButton" class="button ai-load-button">Load Model</button>
              <div class="ai-webgpu-warning" id="aiWebGpuWarning">
                WebGPU is not available. AI features require a browser with WebGPU support.
              </div>
              <div class="help-text ai-help-text">
                Models run locally in your browser. First load downloads the model (~250MB-900MB).
              </div>
            </div>
          </div>
        </div>

        <!-- Custom Rules Section -->
        <div class="rules-section">
          <button class="rules-toggle">
            <span class="noselect">Custom Rules</span>
            <span class="rules-count" id="rulesCount">(0)</span>
            <span class="up-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path
                  d="m16.707 13.293-4-4a1 1 0 0 0-1.414 0l-4 4A1 1 0 0 0 8 15h8a1 1 0 0 0 .707-1.707z"
                  style="fill: #ff8e31"
                  data-name="Up"
                />
              </svg>
            </span>
          </button>
          <div class="rules-content">
            <div class="rules-list" id="rulesList">
              <!-- Rules will be dynamically added here -->
            </div>
            <div class="rules-actions">
              <button id="addRuleButton" class="button rules-button">Add New Rule</button>
              <div class="rules-import-export">
                <button
                  id="exportRulesButton"
                  class="button rules-button secondary"
                  title="Export all rules to JSON file"
                >
                  Export
                </button>
                <button
                  id="importRulesButton"
                  class="button rules-button secondary"
                  title="Import rules from JSON file"
                >
                  Import
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none" />
              </div>
              <div class="help-text export-import-help">
                Export/import rules as JSON files for backup or sharing
              </div>
            </div>
          </div>
        </div>
      </main>
      <footer class="footer-container">
        <div class="separator"></div>
        <div>
          Made by
          <a class="author selectable" href="https://github.com/nitzanpap" target="_blank"
            >Nitzan Papini</a
          >, for <span id="browserName">Firefox</span>
          <span id="browserEmoji"></span>
        </div>
        <div class="feedback-link">
          <a
            href="https://docs.google.com/forms/d/1ViwZsXRSlJqij4nGp84F4gT2f4vBhZkGDQU25F9ESPI"
            target="_blank"
            >Feedback & Requests & Support</a
          >
        </div>
        <div class="version">
          <span>Version: <span id="versionNumber"></span></span>
        </div>
      </footer>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
