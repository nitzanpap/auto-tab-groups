<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Rule - Auto Tab Groups</title>
    <link rel="stylesheet" href="/fonts/inter.css" />
  </head>
  <body>
    <div class="modal-container">
      <h1 id="modalTitle">Create Custom Rule</h1>
      <form id="ruleForm">
        <div class="form-group">
          <label for="ruleName">Rule Name</label>
          <input type="text" id="ruleName" placeholder="e.g., Work Apps, 工作, 仕事" required />
          <div class="help-text">Supports any language including Chinese, Japanese, Korean, and emojis</div>
        </div>
        <div id="aiAssistSection" class="form-group ai-assist-section">
          <label>AI Assist</label>
          <div class="ai-assist-container">
            <textarea
              id="aiDescription"
              rows="2"
              placeholder="Describe your rule, e.g., 'Group all Google services' or 'Group AWS console tabs'"
            ></textarea>
            <button type="button" id="aiGenerateBtn" class="button ai-generate-btn" disabled>
              Generate
            </button>
          </div>
          <div id="aiAssistStatus" class="ai-assist-status"></div>
          <div class="help-text">Describe what you want to group and AI will suggest name, domains, and color</div>
        </div>
        <div id="patternModeToggle" class="form-group pattern-mode-toggle hidden">
          <label>Pattern Mode</label>
          <div class="toggle-buttons">
            <button type="button" id="simpleModeBtn" class="toggle-btn active">
              Simple (domains)
            </button>
            <button type="button" id="explicitModeBtn" class="toggle-btn">
              Explicit (full URLs)
            </button>
          </div>
          <div id="modeHint" class="help-text">Groups all pages from these base domains</div>
        </div>
        <div class="form-group">
          <label for="rulePatterns">URL Patterns (one per line)</label>
          <textarea
            id="rulePatterns"
            rows="4"
            placeholder="example.com
*.github.com
example.com/admin/*
192.168.1.*"
            required
          ></textarea>
          <div class="help-text pattern-help">Supports: domains, wildcards (*.example.com), paths (example.com/api/*), IP addresses</div>
          <div id="patternFeedback" class="pattern-feedback"></div>
        </div>
        <div class="form-group">
          <label>Group Color</label>
          <div id="colorPicker" class="color-picker">
            <button type="button" class="color-btn active" data-color="blue" title="Blue"></button>
            <button type="button" class="color-btn" data-color="red" title="Red"></button>
            <button type="button" class="color-btn" data-color="yellow" title="Yellow"></button>
            <button type="button" class="color-btn" data-color="green" title="Green"></button>
            <button type="button" class="color-btn" data-color="pink" title="Pink"></button>
            <button type="button" class="color-btn" data-color="purple" title="Purple"></button>
            <button type="button" class="color-btn" data-color="cyan" title="Cyan"></button>
            <button type="button" class="color-btn" data-color="orange" title="Orange"></button>
            <button type="button" class="color-btn" data-color="grey" title="Grey"></button>
          </div>
          <input type="hidden" id="ruleColor" value="blue" />
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="ruleEnabled" checked />
            Enabled
          </label>
        </div>
        <div class="button-group">
          <button type="submit" class="button primary" id="saveButton">Save Rule</button>
          <button type="button" class="button secondary" id="cancelButton">Cancel</button>
        </div>
      </form>
      <div id="conflictWarning" class="conflict-warning hidden">
        <h3>Pattern Conflicts Detected</h3>
        <p class="conflict-subtitle">These patterns overlap with existing rules. Tabs matching both rules will only be assigned to one.</p>
        <div id="conflictList" class="conflict-list"></div>
        <div id="conflictResolutions" class="conflict-resolutions hidden">
          <h4>AI Suggestions</h4>
          <ul id="resolutionList"></ul>
        </div>
        <div class="conflict-actions">
          <button type="button" class="button primary" id="saveAnywayBtn">Save Anyway</button>
          <button type="button" class="button secondary" id="goBackBtn">Go Back</button>
        </div>
      </div>
    </div>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
